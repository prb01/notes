# Resources

1. [https://learn.co/tracks/bootcamp-prep-v2](https://learn.co/tracks/bootcamp-prep-v2)
    1. [https://flatironschool.com/free-courses/data-science-bootcamp-prep](https://flatironschool.com/free-courses/data-science-bootcamp-prep)
2. [https://medium.com/building-blocks-on-the-chain/the-complete-javascript-guide-156856dc00b](https://medium.com/building-blocks-on-the-chain/the-complete-javascript-guide-156856dc00b)
3. [https://www.theodinproject.com/](https://www.theodinproject.com/)
4. [https://frontendmasters.com/](https://frontendmasters.com/)
5. [https://www.freecodecamp.org/](https://www.freecodecamp.org/)
6. [https://techbeacon.com/app-dev-testing/bootcamps-wont-make-you-coder-heres-what-will-0](https://techbeacon.com/app-dev-testing/bootcamps-wont-make-you-coder-heres-what-will-0)
7. [https://www.reddit.com/r/learnprogramming/](https://www.reddit.com/r/learnprogramming/)
8. [www.nomadlist.com](www.nomadlist.com)
9. [www.roadmap.sh](www.roadmap.sh)
10. [www.xmpp.org](www.xmpp.org)
11. [www.fullstackopen.com](www.fullstackopen.com)
12. [www.codingame.com](www.codingame.com)
13. [https://www.reddit.com/r/learnprogramming/comments/ielpfq/the_resources_i_wish_i_had_when_i_learned_about/](https://www.reddit.com/r/learnprogramming/comments/ielpfq/the_resources_i_wish_i_had_when_i_learned_about/)
14. [https://www.nocsdegree.com/learn/](https://www.nocsdegree.com/learn/)
15. [https://geddski.teachable.com/p/flexbox-zombies](https://geddski.teachable.com/p/flexbox-zombies)
16. [https://flukeout.github.io/](https://flukeout.github.io/)
17. [http://www.cheat-sheets.org/](http://www.cheat-sheets.org/)
18. [https://datapane.com/](https://datapane.com/)
19. [https://www.fast.ai/](https://www.fast.ai/)
20. [https://www.nahua.dev/about/](https://www.nahua.dev/about/)
21. [https://www.learninpublic.org/?a=63jn2](https://www.learninpublic.org/?a=63jn2)
22. [https://pythondiscord.com/](https://pythondiscord.com/)
23. [https://laconicml.com/ivy-league-universities-courses/](https://laconicml.com/ivy-league-universities-courses/)
24. [https://www.codewars.com/](https://www.codewars.com/)
25. [https://teamtreehouse.com/courses](https://teamtreehouse.com/courses)
26. [www.hackreactor.com](www.hackreactor.com)
27. [https://aws.amazon.com/training/](https://aws.amazon.com/training/)
28. [https://www.learnenough.com/command-line-tutorial/basics](https://www.learnenough.com/command-line-tutorial/basics)
29. [https://www.hoppersroppers.org/course.html](https://www.hoppersroppers.org/course.html)
30. [https://jstherightway.org/](https://jstherightway.org/)
31. [https://www.oakharborwebdesigns.com/](https://www.oakharborwebdesigns.com/)
32. [https://teachyourselfcs.com/](https://teachyourselfcs.com/)
33. [https://2020.stateofjs.com/en-US](https://2020.stateofjs.com/en-US/)
34. [https://golance.com/](https://golance.com/)
35. [https://testingjavascript.com/](https://testingjavascript.com/)
36. [https://developers.google.com/tech-writing](https://developers.google.com/tech-writing)
37. [http://javascriptissexy.com/teaching-yourself-to-code-to-become-an-employable-programmer-what-to-learn-where-to-learn-and-more/](http://javascriptissexy.com/teaching-yourself-to-code-to-become-an-employable-programmer-what-to-learn-where-to-learn-and-more/)
38. [https://www.diagrams.net/](https://www.diagrams.net/)
39. [https://open.appacademy.io](https://open.appacademy.io)



# Learning

1. Languages ([StackOverflow 2020 insight](https://insights.stackoverflow.com/survey/2020/#technology))
    1. CSS
    2. HTML
    3. JavaScript
        1. ES5 / ES6 / Asynchronous Patterns / Promises
    4. [Go (google)](https://golang.org/)
    5. Swift (ios)
    6. Rust (mozilla)
    7. Dart (google)
    8. Scala
2. Frameworks
    1. Angular (JS)
    2. React.js (JS)
    3. Vue.js (JS)
    4. ExpressJS (JS)
    5. Django (Py)
3. Client side concepts & technologies
    1. MVC / React / Redux
    2. Ajax
        1. [https://en.wikipedia.org/wiki/Ajax_(programming)](https://en.wikipedia.org/wiki/Ajax_(programming))
        2. [https://www.w3schools.com/xml/ajax_intro.asp](https://www.w3schools.com/xml/ajax_intro.asp)
4. Server Side Concepts & technologies
    1. Npm / NodeJS / ExpressJS / Authentication
    2. Serverless (scalability)
        1. Lambda (aws)
        2. SQS
        3. DynamoDB (noSQL)
5. Database concepts & technologies
    1. MongoDB
        1. [https://www.mongodb.com/nosql-explained/nosql-vs-sql](https://www.mongodb.com/nosql-explained/nosql-vs-sql)
    2. PostgreSQL
    3. ORMs
    4. Redis
6. Work Environment / Management / Deployment
    1. GIThub
    2. [Ansible](https://en.wikipedia.org/wiki/Ansible_(software))
    3. Puppet
    4. DigitalOcean
    5. Heroku
    6. TDD
7. Web Design
    1. WordPress
    2. Webflow
    3. Wix
8. Docker
9. Kubernetes
10. Terraform
11. Other
    1. RegEx
    2. [Front-End vs Back-End vs Full Stack](https://blog.udacity.com/2014/12/front-end-vs-back-end-vs-full-stack-web-developers.html)
12. Job opportunities
    1. Freelancing
    2. Consulting (web consultancy)


# Projects {#projects}


1. WeKan install - node.js + mongodb
    1. [https://github.com/nodesource/distributions/blob/master/README.md](https://github.com/nodesource/distributions/blob/master/README.md)
    2. [https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/)
    3. [https://github.com/wekan/wekan/wiki/Platforms](https://github.com/wekan/wekan/wiki/Platforms)
2. Setup GIT
3. Create Wiki: [https://wiki.js.org/](https://wiki.js.org/)
    1. [www.Shoutwiki.com](www.Shoutwiki.com)
4. Create utility to post to Craigslist in bulk
5. Create blog from scratch
    1. Using WordPress?
6. Fantasy football? Javascript + API
    1. [https://towardsdatascience.com/fantasy-premier-league-value-analysis-python-tutorial-using-the-fpl-api-8031edfe9910](https://towardsdatascience.com/fantasy-premier-league-value-analysis-python-tutorial-using-the-fpl-api-8031edfe9910) 
7. Spotify combined playlist
8. Portfolio site with astronaut
    1. Space flying behind with mouse movement
    2. Text in helmet
9. Portfolio site normal on mobile, but a mobile in web (with a huge hand?)
10. Create a fantasy stock picks site
11. Mongo DB
    1. [https://docs.mongodb.com/manual/reference/sql-comparison/](https://docs.mongodb.com/manual/reference/sql-comparison/)
    2. [https://www.mongodb.com/blog/channel/quickstart](https://www.mongodb.com/blog/channel/quickstart)
12. Coordination game. Have 16 or so buttons, each one has a different color. When the button is pressed, it fills a square on the screen with that colour. Multiple users play at same time to create some 'art' as fast as possible. Maybe an erase button too?

# VS Code shortcuts {#vs-code-shortcuts}


## ERB

In a .html.erb file:
```rb
pe followed by Tab to get <%= %>
```
```rb
er followed by Tab to get <% %>
```

# POSTGRESQL


# RAILS

## Create new rails app project
```rb
rails _5.2.3_ new my_project_name -G --database=postgresql
```
* **_5.2.3_: **specifies version
* **-G: **specifies NOT to create git repo
* **--database:** sets up defaults based on database to be used


## Gems to include in rails Gemfile
```rb
# Gemfile
gem 'bcrypt'

group :development, :test do
  gem 'better_errors'
  gem 'binding_of_caller'
  gem 'pry-rails'
  gem 'letter_opener'

  gem 'rspec-rails'
  gem 'factory_bot_rails'
  gem 'rails-controller-testing'
end

group :test do
  gem 'faker'
  gem 'capybara'
  gem 'guard-rspec'
  gem 'launchy'
  gem 'shoulda-matchers'
end
```
* ONLY add to development (and test). NEVER to production

**Install with:**
```rb
bundle install
```

## Create databases (PostGreSQL)
```rb
bundle exec rails db:create
```

## Create new migration
```rb
rails generate migration CreateTable
```
* migration name should be camel-case and describe action, e.g. CreateTable, AddColumnToTable etc.


## Perform migration
```rb
rails db:migrate
```

## Check migration status
```rb
rails db:migrate:status
```

## Check rails routes
```rb
rails routes
```

## Open rails terminal/console (gem pry-rails)
```rb
rails console
rails c
```

## Start rails server (to handle http requests)
```rb
rails server
rails s
```

## Configure RSpec
```rb
rails g rspec:install
```

configure **.rspec** file with
```rb
--color
--require spec_helper
--format documentation
```

open **config/application.rb** and add following to Application class:
```rb
config.generators do |g|
  g.test_framework :rspec,
    :fixtures => false,
    :view_specs => false,
    :helper_specs => false,
    :routing_specs => false,
    :controller_specs => true,
    :request_specs => false
end
```

For **‘shoulda-matchers’**, open **spec/rails_helper.rb** and add following within configure:
```rb
Shoulda::Matchers.configure do |config|
   config.integrate do |with|
     with.test_framework :rspec
     with.library :rails
   end
 end
```


# NODE.js (NVM & NPM)
## Installing Node.js
* nvm = Node Version Manager
* npm = Node Package Manager

1. Install NVM
```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
```

2. Check available **node** versions
```bash
nvm ls-remote
```

3. Install **node** version using
```bash
nvm install 16.14   #replace 16.14 with chosen version
```

4. List installed node versions
```bash
nvm ls
```

5. Tell nvm to use chosen node version
```bash
nvm use 16.14
```

6. Check current node version
```bash
nvm current
```

## Create Node project
1. Run below command to configure the package.json file (note that the project folder should already exist and you should be inside of it)
```
npm init
```

2. Add below to scripts in package.json
```
"scripts": {
    "start": "node index.js",
    ...
```

3. Create an index.js file in root of project

4. Run the application using following command (defined in scripts):
```
npm start
```

5. To install other packages, use below syntax:
```
npm install <package-name>
npm install <package-name> --save-dev  #If only to be used for dev
```

Some helpful packages/libraries to install
```
npm install express  #Build backend server (replaces http)
npm install nodemon --save-dev  #File watcher to reload app
npm install morgan  #logger
npm install cors  #cross-origin resource sharing
npm install mongoose  #Work easily with MongoDB
npm install dotenv  #Define env variables to use in app
```

# REACT
## Create new React project
```
npx create-react-app <project/folder_name>
```

## Start React project
```
cd <project/folder_name>
npm start
```

## Create an env variable to be used in React app
Note: env variable must begin with 'REACT_APP_'
```
REACT_APP_API_KEY='xyz' npm start
```
OR, create a `.env` file in root of project and add:
```
REACT_APP_API_KEY='xyz'
```
Env variables are accessed via:
```
process.env.ENV_NAME //e.g. process.env.REACT_APP_API_KEY
```

## Create Prod build of react app
In root directory of project folder run:
```
npm run build
```

This will create a 'build' folder that can be moved elsewhere if required

## Package.json file to merge front-end to back-end, and upload to Heroku (assumes Heroku setup)
Add below scripts to Package.json (updated dir & names as required), and then run `npm run deploy:full`
```json
"scripts": {
    ...    
    "build:ui": "rm -rf build && cd ../../part2/notes-front/ && npm run build && cp -r build ../../part3/notes-back",
    "deploy": "git push heroku main",
    "deploy:full": "npm run build:ui && git add . && echo 'Commit msg for Heroku' && npm run git-commit && npm run deploy && npm run git:fso",
    "git:fso": "cd ../ && git add -A && echo 'Commit msg for FSO' && git commit && git push && cd phonebook/",
    "logs:prod": "heroku logs --tail"
  }
```

# REACT/Router
Provides library to conditionally render components based on the url in the browser
## Install
```
npm install react-router-dom
```

## Main functions
```js
//App.js
import { 
BrowserRouter as Router, 
Routes, 
Route, 
Link,
useParams,
useNavigate,
useMatch } from "react-router-dom"

const User = ({ users }) => {
 const id = useParams().id
 const user = users.find(u => u.id === Number(id))
 const navigate = useNavigate()
 ...
 navigate("/about")
}

const User2 = ({user }) => {
 //do something with user
}

const match = useMatch("/users/:id")
const user = match ? 
  users.find(u => u.id === Number(match.params.id)) : null


return(
  <Link to="/about">About</Link>
  
  <Routes>
   <Route path="/about" element={<About />} />
   <Route path="/users/:id" element={<User user={users} />
   <Route path="/users2/:id" element={<User2 user={user} /> 
 </Routes>
)

//Index.js
<Router>
 <App />
</Router>
```

# REACT/REDUX
## Install
It is common to use the Redux Toolkit alongside React Redux
```
npm install @reduxjs/toolkit react-redux
```

## Create a Redux Store

Create a "slice" file (e.g. notesSlice.js)
```js
import { createSlice } from "@reduxjs/toolkit"

export const notesSlice = createSlice({
  name: "notes",
  initialState: {[]},
  reducers: {
    add: (state, action) => {
      state.push(action.payload)
    },
    remove: (state, action) => {
      state = []
    }
  }
})

export const { add, remove } = notesSlice.actions

//action creator
export const addThenRemove = (content) => {
 return (dispatch) => {
   setTimeout(() => dispatch(remove()), 5000)
   dispatch(add("Hello"))
 }
}

export default notesSlice.reducer
```

Create a store.js
```js
import { configureStore } from "@reduxjs/toolkit"
import notesReducer from "./reducers/notesSlice"

export default configureStore({
  reducer: {
    notes: notesReducer,
  }
})
```

Add to index.js
```js
import store from "./app/store"
import { Provider } from "react-redux"

...
root.render(
  <Provider store={store}>
    <App />
  </Provider>
)
```

Now access store and dispatch actions to it:
```js
//components/NoteForm.js
import React from "react"
import { useSelector, useDispatch } from "react-redux"
import { add, remove, addThenRemove } from "./reducers/notesSlice"

const NoteForm = () => {
  const notes = useSelector((state) => state.notes
  const dispatch = useDispatch()
  
  const handleSubmit = event => {
    event.preventDefault()
    const note = event.target.value
    event.target.value = ""
    dispatch(add(note))
  }

  const handleSubmit2 = event => {
    event.preventDefault()
    const note = event.target.value
    event.target.value = ""
    dispatch(addThenRemove(note))
}
  
  return(
    <div>
      <div>
        <ul>
          {notes.map(note => (
	  <li>{note.content}</li> )}
        </ul>
      </div>
      <form onSubmit={handleSubmit}>
       <input type="text" />
       <button type="submit">add note</button>
      </form>
     <form onSubmit={handleSubmit2}>
       <input type="text" />
       <button type="submit">add then remove</button>
     </form>
    </div>
  )

}

export default NoteForm
```

# REACT STYLING
## Material UI
Install:
```
npm install @mui/material @emotion/react @emotion/styled
```

Example components:
```js
import {
  Container,
  AppBar,
  Toolbar,
  Button,
  Box,
  Paper,
  Typography,
  Alert,
  Snackbar
} from "@mui/material"

//Box & Typography
<Box>
      <Typography>
        <strong>{users.currentUser.name}</strong> logged in
        <Button
          color="inherit"
          variant="outlined"
          onClick={handleLogout}
          sx={{ marginLeft: 1, marginRight: 1 }}
        >
          Logout
        </Button>
      </Typography>
    </Box>

//Menubar
<AppBar position="static">
        <Toolbar disableGutters>
          <Box display="flex" flexGrow={1}>
            <Button color="inherit" component={Link} to="/">
              Blogs
            </Button>
            <Button color="inherit" component={Link} to="/users">
              Users
            </Button>
          </Box>
          {users.currentUser === null ? (
            <Button
              color="inherit"
              variant="outlined"
              component={Link}
              to="/login"
              sx={{ marginLeft: 1, marginRight: 1 }}
            >
              Login
            </Button>
          ) : (
            <>{loggedIn()}</>
          )}
        </Toolbar>
      </AppBar>

//Notifications
<Snackbar open={true}>
      <Alert variant="filled" severity={type}>
        {msg}
      </Alert>
    </Snackbar>
```

Example global theme override (blogTheme.js ):
```js
import { createTheme } from "@mui/material/styles"

export const blogTheme = createTheme({
  components: {
    MuiButtonBase: {
      defaultProps: {},
    },
  },
  palette: {
    primary: {
      main: "#023047",
    },
    secondary: {
      main: "#000000",
    },
  },
})

```
index.js
```js
import { ThemeProvider } from "@mui/material"

const root = ReactDOM.createRoot(document.getElementById("root"))
root.render(
  <Provider store={store}>
    <ThemeProvider theme={blogTheme}>
      <Router>
        <App />
      </Router>
    </ThemeProvider>
  </Provider>
)
```
Documentation:
[MUI/Material UI](https://mui.com/material-ui/getting-started/installation/)


# HEROKU
## Steps to deploy node app to Heroku (assumes account setup already)
1. In root of project, create a file called 'Procfile' and add:
```
web: npm start
```

2. If 'PORT' is defined in app, change so that it uses env variable 'PORT' by default like so:
```js
const PORT = process.env.PORT || 3001
```

3. Create a Git repo in root of project
```
git init
```

4. Add .gitignore file to root of project, and add:
```
node_modules
```

5. Install npm Heroku package (only needs to be done once)
```
npm install -g heroku
```

6. Create a Heroku app with:
```
heroku create
```

7. Git push your files to Heroku with:
```
git add .
git commit -m '<message>'
git push heroku main
```

## Set new ENV variable
Use below syntax to create/set env variable
```
heroku config:set <ENV_NAME>='<VALUE>'
```

# GRAPHQL/SERVER
# Example code:
[Modularizing your GraphQL schema code](https://www.apollographql.com/blog/backend/schema-design/modularizing-your-graphql-schema-code/)
# install
```
npm install apollo-server graphql
```

# Basic steps:
1. Add dependencies (e.g. ApolloServer)
2. Define Types (gql)
3. Define resolvers
4. Define server (ApolloServer) with types and resolvers
5. Call server

# Index.js example
```js
const { ApolloServer, gql } = require("apollo-server")
const { v4: uuidv4 } = require("uuid")

let authors = [
  {
    name: "Robert Martin",
    id: "afa51ab0-344d-11e9-a414-719c6709cf3e",
    born: 1952,
  },
]

let books = [
  {
    title: "Clean Code",
    published: 2008,
    author: "Robert Martin",
    id: "afa5b6f4-344d-11e9-a414-719c6709cf3e",
    genres: ["refactoring"],
  },
]

const typeDefs = gql`
  type Book {
    title: String!
    published: Int!
    author: String!
    genres: [String!]
    id: String!
  }

  type Author {
    name: String!
    born: Int
    id: String!
    bookCount: Int!
  }

  type Query {
    bookCount(author: String): Int!
    authorCount: Int!
    allBooks(author: String, genre: String): [Book!]!
    allAuthors: [Author!]
  }

  type Mutation {
    addBook(
      title: String!
      published: Int!
      author: String!
      genres: [String!]
    ): Book
    editAuthor(name: String!, setBornTo: Int!): Author
  }
`

const resolvers = {
  Query: {
    bookCount: (root, args) => {
      if (!args.author) return books.length
      return books.filter((b) => b.author === args.author).length
    },
    authorCount: (root) => {
      return authors.length
    },
    allBooks: (root, args) => {
      if (!args.author && !args.genre) return books
      return books.filter((b) =>
        args.author
          ? b.author === args.author
          : true && args.genre
          ? b.genres.includes(args.genre)
          : true
      )
    },
    allAuthors: (root) => {
      return authors
    },
  },
  Author: {
    bookCount: (root, args) => {
      return books.filter((b) => b.author === root.name).length
    },
  },
  Mutation: {
    addBook: (root, args) => {
      const book = { ...args, id: uuidv4() }
      books.push(book)
      if (!authors.find((a) => a.name === book.author)) {
        authors.push({ name: args.author, id: uuidv4() })
      }
      return book
    },
    editAuthor: (root, args) => {
      const author = authors.find((a) => a.name === args.name)
      if (!author) return null

      const updatedAuthor = { ...author, born: args.setBornTo }
      authors = authors.map((a) =>
        a.name === args.name ? updatedAuthor : a
      )
      return updatedAuthor
    },
  },
}

const server = new ApolloServer({
  typeDefs,
  resolvers,
})

server.listen().then(({ url }) => {
  console.log(`Server ready at ${url}`)
})

```

## Authentication (server-side)
```js
//User model (mongoose)
const mongoose = require("mongoose")

const schema = new mongoose.Schema({
  username: {
    type: String,
    required: true,
    minlength: 3,
  },
  passwordhash: {
    type: String,
    required: true
  },
  friends: [
    {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Person",
    },
  ],
})

module.exports = mongoose.model("User", schema)
```

```js
//index.js
const User = require("./models/user")
const jwt = require("jsonwebtoken")
const bcrypt = require("bcrypt")
const saltRounds = 10

const typeDefs = gql`
type User {
    username: String!
    friends: [Person!]!
    id: ID!
  }
  type Token {
    value: String!
  }

 type Query {
    me: User
  }

type Mutation {
    createUser(username: String!, password: String!): User
    login(username: String!, password: String!): Token
    addPerson(
      name: String!
      phone: String
      street: String!
      city: String!
    ): Person
  }
`

const resolvers = {
Query: {
    me: (root, args, context) => {
      return context.currentUser
    },
Mutation: {
    createUser: async (root, args) => {
      if (args.password.length < 6) {
        throw new UserInputError("password must be at least 6 chars")
      }

      const passwordhash = await bcrypt.hash(args.password, saltRounds)
      const user = new User({ username: args.username, passwordhash })

      return user.save().catch((error) => {
        throw new UserInputError(error.message, {
          invalidArgs: args,
        })
      })
    },
    login: async (root, args) => {
      const user = await User.findOne({ username: args.username })

      if (
        !user ||
        !(await bcrypt.compare(args.password, user.passwordhash))
      ) {
        throw new UserInputError("wrong credentials")
      }

      const userForToken = {
        username: user.username,
        id: user._id,
      }

      return { value: jwt.sign(userForToken, process.env.JWT_SECRET) }
    },
    addPerson: async (root, args, context) => {
      const person = new Person({ ...args })
      const currentUser = context.currentUser

       if (!currentUser) {
         throw new AuthenticationError("not authenticated")
       }

      try {
        await person.save()
        currentUser.friends = currentUser.friends.concat(person)
        await currentUser.save()
      } catch (error) {
        throw new UserInputError(error.message, {
          invalidArgs: args,
        })
      }
      return person
    },
  },
}

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: async ({ req }) => {
    const auth = req ? req.headers.authorization : null
    if (auth && auth.toLowerCase().startsWith("bearer ")) {
      const decodedToken = jwt.verify(
        auth.substring(7),
        process.env.JWT_SECRET
      )
      const currentUser = await User.findById(decodedToken.id).populate(
        "friends"
      )
      return { currentUser }
    }
  },
})

server.listen().then(({ url }) => {
  console.log(`Server ready at ${url}`)
})
```


# GRAPHQL/CLIENT
## Example code
[Modularizing your GraphQL schema code](https://medium.com/@peterpme/thoughts-on-structuring-your-apollo-queries-mutations-939ba4746cd8)

## Install (note: may need to downgrade React)
```
npm install @apollo/client graphql
```

index.js
```js
import { 
  ApolloClient, ApolloProvider, HttpLink, InMemoryCache} from '@apollo/client' 


const client = new ApolloClient({
  cache: new InMemoryCache(),
  link: new HttpLink({
    uri: 'http://localhost:4000',
  })
})


ReactDOM.render(
  <ApolloProvider client={client}>    <App />
  </ApolloProvider>,  document.getElementById('root')
)
```

To query:
```js
import { gql, useQuery } from "@apollo/client"
...

const ALL_PERSONS = gql`
  query {
    allPersons {
      name
      phone
      id
    }
    personCount
  }
`

const FIND_PERSON = gql`
  query findPersonByName($nameToSearch: String!) {
    findPerson(name: $nameToSearch) {
      name
      phone
      id
      address {
        street
        city
      }
    }
  }
`

const resultAllPersons = useQuery(ALL_PERSONS)

//OR to query repeatedly at interval:
const resultAllPersons = useQuery(ALL_PERSONS, {
    pollInterval: 2000
  })

//OR change the useMutation hook to refetch query when mutation is applied, like so:
const [ createPerson ] = useMutation(CREATE_PERSON, {
    refetchQueries: [ { query: ALL_PERSONS } ]  })

//With multiple queries to update:
const [ createPerson ] = useMutation(CREATE_PERSON, {
    refetchQueries: [ { query: ALL_PERSONS }, { query: OTHER_QUERY }, { query: ... } ] // pass as many queries as you need
  })

//With variables
const resultFindPerson = useQuery(FIND_PERSON, {
    variables: { nameToSearch },
    skip: !nameToSearch,
  })

```


to mutate:
```js
import { gql, useMutation } from '@apollo/client'
...

const CREATE_PERSON = gql`
  mutation createPerson(
    $name: String!
    $street: String!
    $city: String!
    $phone: String
  ) {
    addPerson(name: $name, street: $street, city: $city, phone: $phone) {
      name
      phone
      id
      address {
        street
        city
      }
    }
  }
`

const [ createPerson ] = useMutation(CREATE_PERSON)

//OR to refetch queries
const [ createPerson ] = useMutation(CREATE_PERSON, {
    refetchQueries: [ { query: ALL_PERSONS }, { query: OTHER_QUERY }, { query: ... } ] // pass as many queries as you need
  })

createPerson({  variables: { name, phone, street, city } })
```

handling errors:
```js

const PersonForm= ({ setError }) => {

  const [ createPerson ] = useMutation(CREATE_PERSON, {
    refetchQueries: [  {query: ALL_PERSONS } ],
    onError: (error) => {      setError(error.graphQLErrors[0].message)    }  })
}

const App = () => {
   const notify = (message) => {    setErrorMessage(message)    setTimeout(() => {      setErrorMessage(null)    }, 10000)  }
  
  return (
     <PersonForm setError={notify} />
  )

}
```

## Authentication (client-side)
App.Js:
```js
import {  useApolloClient } from "@apollo/client"
import { useEffect, useState } from "react"
import Notify from "./components/Notify"

const App = () => {
  const [token, setToken] = useState(null)
  const [errorMessage, setErrorMessage] = useState(null)
  const client = useApolloClient()

  if (result.loading)  {
    return <div>loading...</div>
  }

  useEffect(() => {
    const localToken = localStorage.getItem("phonenumbers-user-token")
    if (localToken) {
      setToken(localToken)
    }
  }, [])

  const logout = () => {    
    setToken(null)    
    localStorage.clear()    
    client.resetStore() //clear gql cache 
  }

  if (!token) {    
    return (      
      <>        
       <Notify errorMessage={errorMessage} />
        <LoginForm setToken={setToken} setError={notify} />      
      </>    
    )
  }

  return (
    <>
      <Notify errorMessage={errorMessage} />
      <button onClick={logout}>logout</button>      <Persons persons={result.data.allPersons} />
    </>
  )
}
```

LoginForm.js component:
```js
import { useState, useEffect } from "react"
import { useMutation } from "@apollo/client"
import { LOGIN } from "../queries"

const LoginForm = ({ setError, setToken }) => {
  const [username, setUsername] = useState("")
  const [password, setPassword] = useState("")

  const [login, result] = useMutation(LOGIN, {
    onError: (error) => {
      setError(error.graphQLErrors[0].message)
    },
  })

  useEffect(() => {
    if (result.data) {
      const token = result.data.login.value
      setToken(token)
      localStorage.setItem("phonenumbers-user-token", token)
    }
  }, [result.data]) // eslint-disable-line
  
  const submit = async (event) => {
    event.preventDefault()

    login({ variables: { username, password } })
  }

  return (
    <div>
      <form onSubmit={submit}>
        <div>
          username{" "}
          <input
            value={username}
            onChange={({ target }) => setUsername(target.value)}
          />
        </div>
        <div>
          password{" "}
          <input
            type="password"
            value={password}
            onChange={({ target }) => setPassword(target.value)}
          />
        </div>
        <button type="submit">login</button>
      </form>
    </div>
  )
}

export default LoginForm

```

queries.js
```js
export const LOGIN = gql`
  mutation login($username: String!, $password: String!) {
    login(username: $username, password: $password) {
      value
    }
  }
`
```

index.js (adding token to header):
```js
import { setContext } from "@apollo/client/link/context"

const authLink = setContext((_, { headers }) => {
  const token = localStorage.getItem("phonenumbers-user-token")
  return {
    headers: {
      ...headers,
      authorization: token ? `bearer ${token}` : null,
    },
  }
})

const httpLink = new HttpLink({ uri: "http://localhost:4000" })
const client = new ApolloClient({
  cache: new InMemoryCache(),
  link: authLink.concat(httpLink),
})
```

# REACT NATIVE
## Install
First instal expo. Expo is a platform that eases the setup, development, building, and deployment of React Native applications.
```
npm install --global expo-cli
```

Install Android Studio (to use as emulator)
```
cd /tmp
wget https://dl.google.com/dl/android/studio/ide-zips/2020.3.1.25/android-studio-2020.3.1.25-linux.tar.gz
```
```
sudo tar -zxvf android-studio-*-linux.tar.gz

sudo mv android-studio /opt/
```
```
sudo ln -sf /opt/android-studio/bin/studio.sh /bin/android-studio
```
```
sudo nano /usr/share/applications/android-studio.desktop
```
```
[Desktop Entry]
Version=1.0
Type=Application
Name=Android Studio
Comment=Android Studio
Exec=bash -i "/opt/android-studio/bin/studio.sh" %f
Icon=/opt/android-studio/bin/studio.png
Categories=Development;IDE;
Terminal=false
StartupNotify=true
StartupWMClass=jetbrains-android-studio
Name[en_GB]=android-studio.desktop
```

Next, setup Android Studio so you can use emulator:
[Expo-AndroidStudio Emulator](https://docs.expo.dev/workflow/android-studio-emulator/)


## Initialize project
```
expo init PROJECTNAME --template expo-template-blank@sdk-44 --npm
```

## Setup Lint
```
npm install --save-dev eslint @babel/eslint-parser eslint-plugin-react eslint-plugin-react-native
```

configure by creating `.eslintrc` file
```
{
  "plugins": ["react", "react-native"],
  "settings": {
    "react": {
      "version": "detect"
    }
  },
  "extends": ["eslint:recommended", "plugin:react/recommended"],
  "parser": "@babel/eslint-parser",
  "env": {
    "react-native/react-native": true
  },
  "rules": {
    "react/prop-types": "off",
    "react/react-in-jsx-scope": "off"
  }
}
```

add script to `package.json`
```
"lint": "eslint ./src/**/*.{js,jsx} App.js --no-error-on-unmatched-pattern"
```

## Routing
install:
```
npm install react-router-native
```

## Storing data (localStorage)
In web development, we have used the browser's localStorage object to achieve such functionality. React Native provides similar persistent storage, the AsyncStorage.

install:
```
expo install @react-native-async-storage/async-storage
```
[Async Storage](https://react-native-async-storage.github.io/async-storage/)

For secure storage:
[SecureStore](https://docs.expo.dev/versions/latest/sdk/securestore/)

example Async Storage:
```js
import AsyncStorage from '@react-native-async-storage/async-storage';

class ShoppingCartStorage {
  constructor(namespace = 'shoppingCart') {
    this.namespace = namespace;
  }

  async getProducts() {
    const rawProducts = await AsyncStorage.getItem(
      `${this.namespace}:products`,
    );

    return rawProducts ? JSON.parse(rawProducts) : [];
  }

  async addProduct(productId) {
    const currentProducts = await this.getProducts();
    const newProducts = [...currentProducts, productId];

    await AsyncStorage.setItem(
      `${this.namespace}:products`,
      JSON.stringify(newProducts),
    );
  }

  async clearProducts() {
    await AsyncStorage.removeItem(`${this.namespace}:products`);
  }
}

const doShopping = async () => {
  const shoppingCartA = new ShoppingCartStorage('shoppingCartA');
  const shoppingCartB = new ShoppingCartStorage('shoppingCartB');

  await shoppingCartA.addProduct('chips');
  await shoppingCartA.addProduct('soda');

  await shoppingCartB.addProduct('milk');

  const productsA = await shoppingCartA.getProducts();
  const productsB = await shoppingCartB.getProducts();

  console.log(productsA, productsB);

  await shoppingCartA.clearProducts();
  await shoppingCartB.clearProducts();
};

doShopping();
```

# CI/CD (Github Actions)
## Install
1. Ensure Personal Access Token has access to make changes to workflow in Github
2. In the GIT repo, create a `.github/workflows` directory. YAML workflow files will be saved here
3. Add .yml files to the folder with specifications
4. See actions by going to your GitHub repo and then clicking on Actions at top

Note: tabs are important in YAML files

## Sample YAML file
```yml
name: Deployment pipeline

on:
  push:
    branches:
      - master

jobs:
  simple_deployment_pipeline:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v2
        with:
          node-version: "16"
      - name: npm install
        run: npm install
      - name: lint        
        run: npm run eslint
      - name: build
        run: npm run build
      - name: test
        run: npm test
      - name: e2e tests
        uses: cypress-io/github-action@v2
        with: 
          command: npm run test:e2e
          start: npm run start-prod
          wait-on: http://localhost:5000
```
